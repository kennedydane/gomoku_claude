{% if game.board_state and game.board_state.board %}
<div class="game-board-container board-responsive">
    <div class="game-board-grid" 
         data-game-id="{{ game.id }}"
         data-board-size="{{ game.ruleset.board_size }}"
         data-current-player="{{ game.current_player }}"
         data-game-status="{{ game.status }}"
         id="game-board"
         style="--board-size: {{ game.ruleset.board_size }}; --intersection-size: var(--base-intersection-size, 30px); --stone-size: var(--base-stone-size, 24px);">
    {% for row in game.board_state.board %}
        {% for cell in row %}
            <div class="board-intersection{% if cell %} occupied{% endif %}"
                 data-row="{{ forloop.parentloop.counter0 }}"
                 data-col="{{ forloop.counter0 }}"
                 role="button"
                 tabindex="0"
                 aria-label="Intersection {{ forloop.parentloop.counter0 }}, {{ forloop.counter0 }}{% if cell %} - {{ cell }} stone{% else %} - empty{% endif %}"
                 {% if not cell and game.status == 'ACTIVE' and user == game.get_current_player_user %}
                 hx-post="{% url 'web:game_move' game_id=game.id %}"
                 hx-vals='{"row": {{ forloop.parentloop.counter0 }}, "col": {{ forloop.counter0 }}}'
                 hx-target="#{% if wrapper_id %}{{ wrapper_id }}{% else %}game-board-wrapper{% endif %}"
                 hx-swap="innerHTML"
                 hx-disabled-elt="this"
                 hx-indicator="#board-loading"
                 hx-include="[name='csrfmiddlewaretoken']"
                 {% endif %}>
                {% if cell == 'BLACK' or cell == 'black' %}
                    <div class="stone-black"></div>
                {% elif cell == 'WHITE' or cell == 'white' %}
                    <div class="stone-white"></div>
                {% endif %}
            </div>
        {% endfor %}
    {% endfor %}
    </div>
</div>
{% else %}
<div class="alert alert-warning">
    Board state not initialized. <button onclick="location.reload()" class="btn btn-sm btn-primary">Reload Page</button>
</div>
{% endif %}