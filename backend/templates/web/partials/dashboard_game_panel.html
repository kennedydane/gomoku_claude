<!-- Dashboard Center Panel - Embedded Game Display -->
<div class="card dashboard-game-panel" id="center-game-panel">
    {% if selected_game %}
        <!-- Game Header -->
        <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
                <div class="game-title">
                    <h6 class="mb-0">
                        <i class="bi bi-grid-3x3-gap me-2"></i>{{ selected_game.ruleset.name }}
                    </h6>
                    <small class="text-muted">{{ selected_game.ruleset.board_size }}Ã—{{ selected_game.ruleset.board_size }}</small>
                </div>
                
                <div class="game-status">
                    <span class="badge bg-{% if selected_game.status == 'ACTIVE' %}success{% elif selected_game.status == 'FINISHED' %}primary{% else %}secondary{% endif %}">
                        {{ selected_game.get_status_display }}
                    </span>
                </div>
            </div>
        </div>
        
        <!-- Players Info -->
        <div class="card-body p-2 border-bottom">
            <div class="players-info d-flex justify-content-around align-items-center py-2">
                <div class="player-info text-center">
                    <div class="stone-black d-inline-block mb-1"></div>
                    <div><strong>{{ selected_game.black_player.username }}</strong></div>
                    <small class="text-muted">Black</small>
                </div>
                
                <div class="vs mx-3">
                    <h5 class="mb-0">vs</h5>
                </div>
                
                <div class="player-info text-center">
                    <div class="stone-white d-inline-block mb-1"></div>
                    <div><strong>{{ selected_game.white_player.username }}</strong></div>
                    <small class="text-muted">White</small>
                </div>
            </div>
            
            <!-- Current Turn or Game Result -->
            <div class="game-status-info text-center" 
                 id="game-turn-display">
                {% include 'web/partials/game_turn_display.html' with game=selected_game user=user %}
            </div>
        </div>
        
        <!-- Game Board -->
        <div class="card-body p-3">
            <!-- Loading Indicator -->
            <div id="board-loading" class="htmx-indicator text-center mb-3">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Making move...</span>
                </div>
                <div class="mt-2">Making move...</div>
            </div>
            
            <!-- Error Messages -->
            <div id="board-errors"></div>
            
            <!-- Embedded Game Board -->
            <div id="dashboard-game-board-wrapper">
                <div id="dashboard-game-board-content">
                    {% include 'web/partials/game_board.html' with game=selected_game user=user wrapper_id='dashboard-game-board-content' %}
                </div>
            </div>
            
            <!-- Move History -->
            <div id="dashboard-move-history">
                {% include 'web/partials/move_history.html' with game=selected_game %}
            </div>
        </div>
        
        <!-- Game Actions (minimal) -->
        <div class="card-footer py-2">
            <div class="d-flex justify-content-between align-items-center">
                <div class="game-actions">
                    {% if selected_game.status == 'ACTIVE' %}
                        <button class="btn btn-outline-danger btn-sm" 
                                hx-post="{% url 'web:game_resign' selected_game.id %}"
                                hx-confirm="Are you sure you want to resign this game?"
                                hx-swap="none"
                                hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                                hx-indicator="#board-loading">
                            <i class="bi bi-flag"></i> Resign
                        </button>
                    {% endif %}
                </div>
                
                <div class="view-actions">
                    <!-- Full view is no longer needed since dashboard is the primary interface -->
                    <small class="text-muted">Dashboard View</small>
                </div>
            </div>
        </div>
        
    {% else %}
        <!-- Empty State - No Games -->
        <div class="card-body text-center py-5">
            <i class="bi bi-grid-3x3-gap display-1 text-muted mb-4"></i>
            <h5 class="text-muted mb-3">No Active Games</h5>
            <p class="text-muted mb-4">
                Start a new game by challenging a friend, or wait for someone to challenge you!
            </p>
            <div class="d-flex justify-content-center gap-3">
                <button class="btn btn-primary"
                        hx-get="{% url 'web:friends_modal' %}"
                        hx-target="#friends-modal-container"
                        data-bs-toggle="modal"
                        data-bs-target="#friends-modal">
                    <i class="bi bi-people"></i> Find Friends to Challenge
                </button>
            </div>
        </div>
    {% endif %}
</div>

<style>
/* Dashboard Game Panel Styling */
.dashboard-game-panel {
    height: fit-content;
    min-height: 400px;
}

.dashboard-game-panel .players-info {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 8px;
    margin: 0 -0.5rem;
}

.dashboard-game-panel .stone-black, 
.dashboard-game-panel .stone-white {
    width: 20px;
    height: 20px;
    min-width: 20px;
    min-height: 20px;
}

.dashboard-game-panel .stone-black {
    background: radial-gradient(circle at 30% 30%, #444, #000);
    border-radius: 50%;
    border: 1px solid #333;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.dashboard-game-panel .stone-white {
    background: radial-gradient(circle at 30% 30%, #fff, #ddd);
    border-radius: 50%;
    border: 1px solid #333;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.dashboard-game-panel .vs {
    color: #6c757d;
}

.dashboard-game-panel .current-turn,
.dashboard-game-panel .game-winner {
    font-size: 0.95rem;
    padding: 0.5rem;
    background: rgba(13, 110, 253, 0.1);
    border-radius: 6px;
    margin-top: 0.5rem;
}

.dashboard-game-panel .game-board-container {
    padding: 10px;
}

.dashboard-game-panel .game-board-grid {
    /* Container-relative sizing with higher minimum to prevent tiny boards */
    --fluid-intersection-size: min(
        8vh,
        min(45vw, 1024px) / var(--board-size-num, 8)
    ) !important;
    --fluid-stone-size: calc(var(--fluid-intersection-size) * 0.8) !important;
}

/* Responsive adjustments for dashboard panel */
@media (max-width: 992px) {
    .dashboard-game-panel .game-board-grid {
        --fluid-intersection-size: min(
            6vh,
            min(40vw, 800px) / var(--board-size-num, 8)
        ) !important;
    }
}

@media (max-width: 768px) {
    .dashboard-game-panel {
        min-height: 300px;
    }
    
    .dashboard-game-panel .players-info {
        flex-direction: column;
        gap: 1rem;
    }
    
    .dashboard-game-panel .vs {
        display: none;
    }
    
    .dashboard-game-panel .game-board-grid {
        --fluid-intersection-size: min(
            4vh,
            min(60vw, 600px) / var(--board-size-num, 8)
        ) !important;
    }
}

/* Loading states */
.dashboard-game-panel .htmx-indicator {
    display: none;
}

.dashboard-game-panel .htmx-request .htmx-indicator {
    display: block;
}

.dashboard-game-panel .htmx-request .game-board-container {
    opacity: 0.6;
    pointer-events: none;
}
</style>

